| ID | Category | Requirement | Rationale & Impact | Target Component(s) |
| --- | --- | --- | --- | --- |
| **REQ-01** | **Architecture (Critical)** | **Implement Graph-Augmented Retrieval (GraphRAG)**<br>

<br>Modify the retrieval pipeline to query the Knowledge Graph for concepts related to the user's query and inject those connected chunks into the context alongside vector search results. | **Current Gap:** The graph is visualized but ignored during chat.<br>

<br>**Impact:** Allows the AI to "reason" across papers (e.g., connecting "Method A" in Paper 1 to "Method A" in Paper 2 even if keywords differ). | `src/ai_engine.py`<br>

<br>`src/database.py` |
| **REQ-02** | **Schema** | **Add Granular Metadata to Chunks**<br>

<br>Add a `metadata` JSONB column to the `file_chunks` table. Update ingestion to store page numbers, section headers, and bounding boxes from Docling. | **Current Gap:** `file_chunks` only stores text content.<br>

<br>**Impact:** Enables precise citations (e.g., "See Page 4, Section 2.1") which is critical for academic trust. | `schema.sql`<br>

<br>`src/ingestion.py`<br>

<br>`src/database.py` |
| **REQ-03** | **Data Integrity** | **Fix Vector Dimension Mismatch**<br>

<br>Change the `file_chunks.embedding` column definition to match the model output (likely `768` for `nomic-embed-text`) or make it dynamic. | **Current Gap:** Schema defines `vector(1024)` but default config uses `nomic-embed-text` (768 dim).<br>

<br>**Impact:** Prevents runtime SQL insertion errors. | `schema.sql`<br>

<br>`src/config.py` |
| **REQ-04** | **Ingestion** | **Filter Bibliographies & References**<br>

<br>Implement a heuristic in the parser to detect "References" or "Bibliography" sections and flag them to be excluded from standard retrieval. | **Current Gap:** No filtering logic exists.<br>

<br>**Impact:** Prevents "citation pollution" where the search retrieves the bibliography list instead of the actual content. | `src/ingestion.py` |
| **REQ-05** | **AI Reliability** | **Enforce Structured JSON Extraction**<br>

<br>Replace regex-based JSON cleaning with a robust library (like `instructor` or `pydantic`) or improved error handling/retries for graph extraction. | **Current Gap:** Relies on unstable regex cleaning (`_clean_json_string`).<br>

<br>**Impact:** Prevents the ingestion pipeline from crashing or creating empty graphs when local LLMs output malformed JSON. | `src/ai_engine.py` |
| **REQ-06** | **Knowledge Graph** | **Implement Entity Resolution**<br>

<br>Add a normalization step before storing nodes to merge synonyms (e.g., "LLM", "Large Language Model", "llm") into a single canonical node. | **Current Gap:** Only simple `.strip().lower()` normalization is used.<br>

<br>**Impact:** Prevents a fragmented graph where connections are missed due to slight naming variations. | `src/database.py`<br>

<br>`src/ai_engine.py` |
| **REQ-07** | **Ingestion** | **Semantic Table Handling**<br>

<br>Detect table elements during parsing. Summarize the table for the embedding vector but store the raw HTML/Markdown in the chunk content for display. | **Current Gap:** Tables are treated as standard text chunks.<br>

<br>**Impact:** Preserves the structure of data tables which are often broken by standard text chunking. | `src/ingestion.py` |